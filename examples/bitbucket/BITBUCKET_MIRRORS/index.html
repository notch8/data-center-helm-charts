<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../../../assets/logos/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.0.3"><title>Smart Mirrors - Atlassian DC Helm Charts</title><link rel=stylesheet href=../../../assets/stylesheets/main.62128196.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.9204c3b2.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/stylesheets/extra.css><script>function __md_scope(e,t,_){return new URL(_||(t===localStorage?"../../..":"../../.."),location).pathname+"."+e}function __md_get(e,t=localStorage,_){return JSON.parse(t.getItem(__md_scope(e,t,_)))}function __md_set(e,t,_=localStorage,o){try{_.setItem(__md_scope(e,_,o),JSON.stringify(t))}catch(e){}}</script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-FZ7HCVNVPY"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-FZ7HCVNVPY",{page_path:e.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-FZ7HCVNVPY"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#smart-mirroring class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <a href=https://community.atlassian.com/t5/Atlassian-Data-Center-on/gh-p/DC_Kubernetes title="Share your feedback with the Atlassian Data Center on Kubernetes Community" style=color:white><strong>Share your feedback and join the discussion</strong></a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Atlassian DC Helm Charts" class="md-header__button md-logo" aria-label="Atlassian DC Helm Charts" data-md-component=logo> <img src=../../../assets/logos/atlassian-logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Atlassian DC Helm Charts </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Smart Mirrors </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/atlassian/data-center-helm-charts/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> atlassian/data-center-helm-charts </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../userguide/PREREQUISITES/ class=md-tabs__link> User guide </a> </li> <li class=md-tabs__item> <a href=../../EXAMPLES/ class="md-tabs__link md-tabs__link--active"> Examples </a> </li> <li class=md-tabs__item> <a href=../../../troubleshooting/TROUBLESHOOTING/ class=md-tabs__link> Troubleshooting </a> </li> <li class=md-tabs__item> <a href=../../../platforms/PLATFORMS/ class=md-tabs__link> Platforms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Atlassian DC Helm Charts" class="md-nav__button md-logo" aria-label="Atlassian DC Helm Charts" data-md-component=logo> <img src=../../../assets/logos/atlassian-logo.svg alt=logo> </a> Atlassian DC Helm Charts </label> <div class=md-nav__source> <a href=https://github.com/atlassian/data-center-helm-charts/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> atlassian/data-center-helm-charts </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> User guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User guide" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../userguide/PREREQUISITES/ class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=../../../userguide/INSTALLATION/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../../userguide/CONFIGURATION/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../../userguide/MIGRATION/ class=md-nav__link> Migration </a> </li> <li class=md-nav__item> <a href=../../../userguide/OPERATION/ class=md-nav__link> Operation </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_6 type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6> Upgrades <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Upgrades data-md-level=2> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> Upgrades </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../userguide/upgrades/HELM_CHART_UPGRADE/ class=md-nav__link> Helm chart upgrade </a> </li> <li class=md-nav__item> <a href=../../../userguide/upgrades/PRODUCTS_UPGRADE/ class=md-nav__link> Products upgrade </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_7 type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7> Resource management <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Resource management" data-md-level=2> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> Resource management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../userguide/resource_management/JIRA_INDEX_SNAPSHOT/ class=md-nav__link> Creating an initial index snapshot in Jira </a> </li> <li class=md-nav__item> <a href=../../../userguide/resource_management/REQUESTS_AND_LIMITS/ class=md-nav__link> Resource requests and limits </a> </li> <li class=md-nav__item> <a href=../../../userguide/resource_management/RESOURCE_SCALING/ class=md-nav__link> Product scaling </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Examples <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Examples data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../EXAMPLES/ class=md-nav__link> Available examples </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> Kubernetes cluster <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kubernetes cluster" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Kubernetes cluster </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cluster/AKS_SETUP/ class=md-nav__link> Preparing an AKS cluster </a> </li> <li class=md-nav__item> <a href=../../cluster/CLOUD_PROVIDERS/ class=md-nav__link> Provisioning Kubernetes clusters on cloud-based providers </a> </li> <li class=md-nav__item> <a href=../../cluster/EKS_SETUP/ class=md-nav__link> Preparing an EKS cluster </a> </li> <li class=md-nav__item> <a href=../../cluster/GKE_SETUP/ class=md-nav__link> Preparing an GKE cluster </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3> Database <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Database data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Database </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../database/AMAZON_RDS/ class=md-nav__link> Creating an RDS database instance </a> </li> <li class=md-nav__item> <a href=../../database/CLOUD_PROVIDERS/ class=md-nav__link> Provisioning databases on cloud-based providers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Ingress <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ingress data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Ingress </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ingress/CONTROLLERS/ class=md-nav__link> Provisioning an Ingress controller </a> </li> <li class=md-nav__item> <a href=../../ingress/DNS/ class=md-nav__link> Create DNS record via AWS CLI </a> </li> <li class=md-nav__item> <a href=../../ingress/INGRESS_NGINX/ class=md-nav__link> NGINX Ingress Controller - with TLS termination </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5> Storage <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Storage data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../storage/STORAGE/ class=md-nav__link> Shared storage </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_2 type=checkbox id=__nav_3_5_2> <label class=md-nav__link for=__nav_3_5_2> AWS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=AWS data-md-level=3> <label class=md-nav__title for=__nav_3_5_2> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../storage/aws/LOCAL_STORAGE/ class=md-nav__link> Local storage </a> </li> <li class=md-nav__item> <a href=../../storage/aws/SHARED_STORAGE/ class=md-nav__link> Shared storage </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_3 type=checkbox id=__nav_3_5_3> <label class=md-nav__link for=__nav_3_5_3> NFS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=NFS data-md-level=3> <label class=md-nav__title for=__nav_3_5_3> <span class="md-nav__icon md-icon"></span> NFS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../storage/nfs/NFS/ class=md-nav__link> NFS server for Bitbucket </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6 type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6> Bamboo <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Bamboo data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Bamboo </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../bamboo/REMOTE_AGENTS/ class=md-nav__link> Remote agents </a> </li> <li class=md-nav__item> <a href=../../bamboo/AGENT_CAPABILITIES/ class=md-nav__link> Agent capabilities </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7 type=checkbox id=__nav_3_7 checked> <label class=md-nav__link for=__nav_3_7> Bitbucket <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Bitbucket data-md-level=2> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Bitbucket </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../BITBUCKET_ELASTICSEARCH/ class=md-nav__link> Elasticsearch </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Smart Mirrors <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Smart Mirrors </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#requirements class=md-nav__link> Requirements </a> </li> <li class=md-nav__item> <a href=#installation class=md-nav__link> Installation </a> <nav class=md-nav aria-label=Installation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#steps class=md-nav__link> Steps </a> <nav class=md-nav aria-label=Steps> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mirror-farm-installation-in-kubernetes class=md-nav__link> Mirror Farm installation in Kubernetes </a> </li> <li class=md-nav__item> <a href=#mirror-farm-authorization class=md-nav__link> Mirror farm authorization </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#scaling-the-mirror-farm class=md-nav__link> Scaling the mirror farm </a> </li> <li class=md-nav__item> <a href=#adding-or-removing-additional-mirror-farms class=md-nav__link> Adding or removing additional mirror farms </a> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../BITBUCKET_SSH/ class=md-nav__link> SSH </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../logging/efk/EFK/ class=md-nav__link> Logging in a Kubernetes environment </a> </li> <li class=md-nav__item> <a href=../../external_libraries/EXTERNAL_LIBS/ class=md-nav__link> External libraries and plugins </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Troubleshooting <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Troubleshooting data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Troubleshooting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../troubleshooting/TROUBLESHOOTING/ class=md-nav__link> Troubleshooting tips </a> </li> <li class=md-nav__item> <a href=../../../troubleshooting/SUPPORT_BOUNDARIES/ class=md-nav__link> Support boundaries </a> </li> <li class=md-nav__item> <a href=../../../troubleshooting/LIMITATIONS/ class=md-nav__link> Limitations </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Platforms <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Platforms data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Platforms </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../platforms/PLATFORMS/ class=md-nav__link> Platform information </a> </li> <li class=md-nav__item> <a href=../../../platforms/OPENSHIFT/ class=md-nav__link> OpenShift </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#requirements class=md-nav__link> Requirements </a> </li> <li class=md-nav__item> <a href=#installation class=md-nav__link> Installation </a> <nav class=md-nav aria-label=Installation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#steps class=md-nav__link> Steps </a> <nav class=md-nav aria-label=Steps> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mirror-farm-installation-in-kubernetes class=md-nav__link> Mirror Farm installation in Kubernetes </a> </li> <li class=md-nav__item> <a href=#mirror-farm-authorization class=md-nav__link> Mirror farm authorization </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#scaling-the-mirror-farm class=md-nav__link> Scaling the mirror farm </a> </li> <li class=md-nav__item> <a href=#adding-or-removing-additional-mirror-farms class=md-nav__link> Adding or removing additional mirror farms </a> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/atlassian/data-center-helm-charts/edit/main/docs/docs/examples/bitbucket/BITBUCKET_MIRRORS.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=smart-mirroring>Smart Mirroring<a class=headerlink href=#smart-mirroring title="Permanent link"> ¶</a></h1> <p>Smart Mirroring can greatly improve Git clone speeds for distributed teams working with large repositories. Large repositories that take hours to clone from a Bitbucket instance over the Internet from the other side of the world can take minutes when cloned from a local mirror on a fast network.</p> <p><img alt="smart mirrors" src=../../../assets/images/bitbucket_mirrors/smart_mirrors_diagram.png></p> <p>You can learn more details about smart mirroring on the <a href=https://confluence.atlassian.com/bitbucketserver/smart-mirroring-776640046.html>official documentation page</a>.</p> <div class="admonition tip"> <p class=admonition-title>Upstream/Primary instance</p> <p><strong>Primary instance</strong> is sometimes called <strong>upstream</strong> instance.</p> </div> <h2 id=requirements>Requirements<a class=headerlink href=#requirements title="Permanent link"> ¶</a></h2> <div class="admonition warning"> <p class=admonition-title>Primary instance prerequisites</p> <p><strong>Your primary Bitbucket instance must be a fully licensed Bitbucket Data Center instance</strong></p> <p>You do not have to run your Bitbucket Data Center instance as a multi-node cluster to use smart mirroring, but you must have an up-to-date Data Center license.</p> <p><strong>The primary instance and all mirror(s) must have HTTPS with a valid (i.e., signed by a Certificate Authority anchored to the root and not expired) SSL certificate</strong></p> <p>This is a strict requirement of smart mirroring on both the primary instance and all mirror(s), and cannot be bypassed. The mirror setup wizard will not proceed if either the mirror or the primary instance does not have a valid SSL certificate.</p> <p><strong>The primary Bitbucket instance must have SSH enabled</strong></p> <p>Mirrors keep their repositories synchronized with the primary instance over SSH and cannot use HTTP or HTTPS for this. See Enable SSH access to Git repositories for instructions on enabling SSH access on your primary instance.</p> </div> <h2 id=installation>Installation<a class=headerlink href=#installation title="Permanent link"> ¶</a></h2> <h3 id=overview>Overview<a class=headerlink href=#overview title="Permanent link"> ¶</a></h3> <ol> <li>Install the <strong>primary</strong> as usual with Bitbucket Helm chart.<ul> <li>You need to make sure the instance complies with all the above listed requirements.</li> </ul> </li> <li>Install the <strong>mirror</strong> with second Bitbucket Helm chart.<ul> <li>There is a set of properties that need to be configured to make the mirror work.</li> </ul> </li> <li>Approve the <strong>mirror</strong> in the <strong>primary</strong> instance.</li> </ol> <h3 id=steps>Steps<a class=headerlink href=#steps title="Permanent link"> ¶</a></h3> <h4 id=mirror-farm-installation-in-kubernetes>Mirror Farm installation in Kubernetes<a class=headerlink href=#mirror-farm-installation-in-kubernetes title="Permanent link"> ¶</a></h4> <div class="admonition info ingress configuration"> <p class=admonition-title>Info</p> <p>Example is using <a href=../../ingress/INGRESS_NGINX/ >nginx-ingress controller</a>. If you are using a different ingress controller, you will need to modify the example.</p> </div> <ol> <li>Install the <strong>primary</strong> as usual with Bitbucket Helm chart.<ul> <li>You need to make sure the instance complies with all the above listed requirements.</li> <li>Verify that you are able to clone from the primary via SSH protocol.</li> <li>Verify that primary instance is accessible over HTTPS with a valid SSL certificate.</li> </ul> </li> <li>Create a new file <code>values-mirror.yaml</code> with the following content: <div class=highlight><pre><span></span><code><span class=nt>bitbucket</span><span class=p>:</span>
  <span class=nt>mode</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mirror</span>
  <span class=nt>displayName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Bitbucket Mirror</span>
  <span class=nt>clustering</span><span class=p>:</span>
    <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class=nt>applicationMode</span><span class=p>:</span> <span class=s>&quot;mirror&quot;</span>
  <span class=nt>mirror</span><span class=p>:</span>
    <span class=nt>upstreamUrl</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;https url of the primary&gt;</span> <span class=c1># for example https://bitbucket-upstream.example.com</span>

<span class=c1># nginx specific configuration</span>
<span class=nt>ingress</span><span class=p>:</span>
  <span class=nt>create</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class=nt>host</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bitbucket-mirror.example.com</span>
  <span class=nt>annotations</span><span class=p>:</span>
    <span class=nt>cert-manager.io/issuer</span><span class=p>:</span> <span class=s>&quot;letsencrypt-prod&quot;</span> <span class=c1># Default issuer</span>
  <span class=nt>tlsSecretName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;secret with TLS private key&gt;</span> <span class=c1># E.g. tls-certificate-mirror</span>

<span class=c1># enables persistence for mirror data</span>
<span class=nt>volumes</span><span class=p>:</span>
  <span class=nt>localHome</span><span class=p>:</span>
    <span class=nt>persistentVolumeClaim</span><span class=p>:</span>
      <span class=nt>create</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div></li> <li>Edit the file to change the placeholder values.<ul> <li><code>bitbucket.mirror.upstreamUrl</code></li> <li><code>ingress.host</code></li> <li><code>ingress.tlsSecretName</code></li> </ul> </li> <li>Install the mirror <div class=highlight><pre><span></span><code>  helm install bitbucket-mirror atlassian-data-center/bitbucket -f values-mirror.yaml
</code></pre></div></li> </ol> <h4 id=mirror-farm-authorization>Mirror farm authorization<a class=headerlink href=#mirror-farm-authorization title="Permanent link"> ¶</a></h4> <p>These steps are described in detail in <a href=https://confluence.atlassian.com/bitbucketserver/set-up-and-configure-a-mirror-farm-978205589.html#Setupandconfigureamirrorfarm-4.Approvethemirrorfarmrequest>official documentation</a>.</p> <ol> <li>Visit the mirror URL (it might take a couple of minutes to come up)</li> <li>Click on <em>Go to the primary server</em> in the mirror UI. The link will take you to the administration section of the primary instance.<br> <img alt=mirror_setup src=../../../assets/images/bitbucket_mirrors/mirror_authorize.png width=400></li> <li>Click <em>Authorize</em> next to the mirror<br> <img alt=click_authorize src=../../../assets/images/bitbucket_mirrors/upstream_authorize.png></li> <li>Select which projects should be synchronized<br> <img alt=select_projects src=../../../assets/images/bitbucket_mirrors/select_projects_to_mirror.png></li> <li>Wait for the projects to be synchronized<br> <img alt=project_synchronized src=../../../assets/images/bitbucket_mirrors/mirror_synchronized.png></li> <li>Verify that the synchronized projects can be cloned from the mirror<br> <img alt=clone_from_mirror src=../../../assets/images/bitbucket_mirrors/clone_from_mirror.png width=400></li> </ol> <h2 id=scaling-the-mirror-farm>Scaling the mirror farm<a class=headerlink href=#scaling-the-mirror-farm title="Permanent link"> ¶</a></h2> <p>As the mirror is deployed with all the fulfilled requirements for the Bitbucket Mirror Farm, you are able to scale the mirrors easily. To increase or decrease the size of the mirror farm:</p> <div class=highlight><pre><span></span><code>helm upgrade --set <span class=nv>replicaCount</span><span class=o>=</span>&lt;desired number of mirror nodes&gt; <span class=se>\</span>
             --reuse-values <span class=se>\</span>
             &lt;name of the release&gt;
             atlassian-data-center/bitbucket
</code></pre></div> <h2 id=adding-or-removing-additional-mirror-farms>Adding or removing additional mirror farms<a class=headerlink href=#adding-or-removing-additional-mirror-farms title="Permanent link"> ¶</a></h2> <p>It is possible to connect multiple mirror farms to a single primary instance. This can be useful to improve local performance for geographically distributed teams.</p> <p><em>To add a new mirror farm</em>, follow the same steps that were necessary to connect the first mirror farm. This means installing another helm release and authenticating it in the administrator user interface.</p> <p><em>To remove a mirror farm</em>:</p> <ol> <li>Navigate to <em>Mirrors</em> administration section on the <strong>primary</strong></li> <li>Select the mirror from the list</li> <li>Click <em>Delete</em> button</li> <li>Uninstall the deleted mirror helm release from the cluster</li> </ol> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link"> ¶</a></h2> <p>You can find the most common errors in mirror configuration described in the <a href=https://confluence.atlassian.com/bitbucketserverkb/troubleshooting-smart-mirroring-838407670.html>official Bitbucket documentation</a>.</p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../BITBUCKET_ELASTICSEARCH/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Elasticsearch" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Elasticsearch </div> </div> </a> <a href=../BITBUCKET_SSH/ class="md-footer__link md-footer__link--next" aria-label="Next: SSH" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> SSH </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; [2020] to [2021] Atlassian and others. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://community.atlassian.com/t5/Atlassian-Data-Center-on/gh-p/DC_Kubernetes target=_blank rel=noopener title=community.atlassian.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M152.2 236.4c-7.7-8.2-19.7-7.7-24.8 2.8L1.6 490.2c-5 10 2.4 21.7 13.4 21.7h175c5.8.1 11-3.2 13.4-8.4 37.9-77.8 15.1-196.3-51.2-267.1zM244.4 8.1c-122.3 193.4-8.5 348.6 65 495.5 2.5 5.1 7.7 8.4 13.4 8.4H497c11.2 0 18.4-11.8 13.4-21.7 0 0-234.5-470.6-240.4-482.3-5.3-10.6-18.8-10.8-25.6.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.instant", "navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.01824240.min.js"}</script> <script src=../../../assets/javascripts/bundle.e0abf5b0.min.js></script> </body> </html>